<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: PersonForm.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: PersonForm.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import md5 from "md5";
import * as React from "react";
import { useState } from "react";
import Grid from "@mui/material/Grid";
import { Container } from "@mui/system";
import InputLabel from "@mui/material/InputLabel";
import IconButton from "@mui/material/IconButton";
import FormControl from "@mui/material/FormControl";
import { Link, useNavigate } from "react-router-dom";
import Autocomplete from "@mui/material/Autocomplete";
import OutlinedInput from "@mui/material/OutlinedInput";
import Visibility from "@mui/icons-material/Visibility";
import InputAdornment from "@mui/material/InputAdornment";
import VisibilityOff from "@mui/icons-material/VisibilityOff";
import { Helmet, HelmetProvider } from "react-helmet-async";
import {
  Card,
  CardContent,
  TextField,
  Typography,
  Button,
  CircularProgress,
  Box,
  CssBaseline,
  Alert,
} from "@mui/material";


export default function PersonForm() {

  const kindUser = [{ label: "Cliente" }, { label: "Empleado" }];

  //** this is a navigate */
  const navigate = useNavigate();

  const [loading, setLoading] = useState(false);

  const [showPassword, setShowPassword] = React.useState(false);

  const handleClickShowPassword = () => setShowPassword((show) => !show);

  const handleMouseDownPassword = (event) => {
    event.preventDefault();
  };

  const [kindPerson, setKindPerson] = useState({
    type_user: "",
  });

  const [person, setPerson] = useState({
    first_name: "",
    last_name: "",
    email: "",
    phone: "",
    password: "",
  });

  const handleChangePerson = (e) => {
    setPerson({ ...person, [e.target.name]: e.target.value });
  };

  const [address, setAddress] = useState({
    description: "",
    person_id: "",
  });

  const handleChangeAddress = (e) => {
    setAddress({ ...address, [e.target.name]: e.target.value });
  };

  /**
   * function to encrypt the password
   * @param {string} password
   * @returns {string} password encriptada
   */
  function encriptarPassword(password) {
    return md5(password);
  }

  const isEmailValid = (email) => {
    const emailRegex = /\S+@\S+\.\S+/;
    return emailRegex.test(email);
  };

  //UseStates for error and alert message if the data in form is not valid
  const [error, setError] = useState(null);
  const [showAlert, setShowAlert] = useState(false);

  const handleSubmit = async (e) => {
    e.preventDefault();

    setLoading(true);

    if (!isEmailValid(person.email)) {
      setError("email");
      setShowAlert(true);
      setLoading(false);
      return;
    }
    if (person.password.length &lt; 8) {
      setError("password");
      setShowAlert(true);
      setLoading(false);
      return;
    } else {
      person.password = encriptarPassword(person.password);
    }

    let continuePage = false;
    let id = 0;

    //Valida si el correo o el telefono ya existen donde en caso de que exista devuelve True y en caso de que no exista devuelve False
    const dataValidation = await fetch(
      "http://localhost:4000/person/validation",
      {
        method: "POST",
        body: JSON.stringify(person),
        headers: {
          "Content-Type": "application/json",
        },
      }
    );
    const dataResultValidation = await dataValidation.json();

    if (person.phone.length &lt; 10 || person.phone.length > 10) {
      setError("phone");
      setShowAlert(true);
      continuePage = false;
      setLoading(false);
      return;
    }

    //Crea en base de los datos la persona y la direccion si la validacion es false
    if (dataResultValidation.message === false) {
      continuePage = true;
      const data = await fetch("http://localhost:4000/person", {
        method: "POST",
        body: JSON.stringify(person),
        headers: {
          "Content-Type": "application/json",
        },
      });

      const dataResult = await data.json();
      console.log(dataResult);
      id = dataResult.person_id;

      //Contruye el objeto completo para enviar a la tabla address
      const completeAddress = {
        description: address.description,
        person_id: dataResult.person_id,
      };
      //Envia el objeto completo a la tabla address
      const dataAddress = await fetch("http://localhost:4000/address", {
        method: "POST",
        body: JSON.stringify(completeAddress),
        headers: {
          "Content-Type": "application/json",
        },
      });
      const dataResultAddress = await dataAddress.json();
      if (dataResultAddress.message === "Address not found") {
        setError("address");
        setShowAlert(true);
        continuePage = false;
        setTimeout(() => {
          if (kindPerson.type_user.label === "Cliente") {
            navigate(`/address/client/${id}`);
          } else if (kindPerson.type_user.label === "Empleado") {
            navigate(`/address/employee/${id}`);
          }
        }, 7000);
        return;
      }
      console.log(dataResultAddress);
    } else {
      continuePage = false;
    }

    setLoading(false);

    if (continuePage === true) {
      if (kindPerson.type_user.label === "Cliente") {
        navigate(`/client/${id}/new`);
      } else if (kindPerson.type_user.label === "Empleado") {
        navigate(`/employee/${id}/new`);
      }
    } else {
      setError("email-phone");
      setShowAlert(true);
    }
  };

  return (
    &lt;HelmetProvider>
      &lt;Helmet>
        &lt;style>{"body { background-color: #003748; }"}&lt;/style>
      &lt;/Helmet>
      &lt;nav className="navbar navbar-expand-lg navbar-light bg-light">
        &lt;div className="container-fluid">
          &lt;Link className="navbar-brand" to="/">
            Mande
          &lt;/Link>
          &lt;button
            className="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            &lt;span className="navbar-toggler-icon">&lt;/span>
          &lt;/button>
        &lt;/div>
      &lt;/nav>
      &lt;Container component="main" maxWidth="xs">
        &lt;CssBaseline />
        &lt;Box
          sx={{
            marginTop: 1,
            display: "flex",
            flexDirection: "column",
            alignItems: "center",
          }}
        >
          &lt;Card
            sx={{ mt: 10, borderRadius: ".5rem" }}
            style={{
              backgroundColor: "#f7f6f6",
              padding: "1rem",
            }}
          >
            &lt;Typography
              variant="h5"
              style={{
                textAlign: "center",
                marginBottom: "-2.7rem",
              }}
            >
              Registrate
            &lt;/Typography>
            &lt;CardContent>
              &lt;Box
                component="form"
                noValidate
                onSubmit={handleSubmit}
                sx={{ mt: 3 }}
              >
                &lt;Grid container spacing={2}>
                  &lt;Grid item xs={12} sm={6}>
                    &lt;TextField
                      variant="outlined"
                      label="Nombre completo"
                      fullWidth
                      sx={{
                        display: "block",
                        margin: ".5rem 0",
                      }}
                      name="first_name"
                      onChange={handleChangePerson}
                      InputLabelProps={{ style: { color: "black" } }}
                    />
                  &lt;/Grid>
                  &lt;Grid item xs={12} sm={6}>
                    &lt;TextField
                      variant="outlined"
                      label="Apellidos"
                      fullWidth
                      sx={{
                        display: "block",
                        margin: ".5rem 0",
                      }}
                      name="last_name"
                      onChange={handleChangePerson}
                      InputLabelProps={{ style: { color: "black" } }}
                    />
                  &lt;/Grid>
                  &lt;Grid item xs={12}>
                    &lt;TextField
                      variant="outlined"
                      label="Correo electronico"
                      fullWidth
                      name="email"
                      onChange={handleChangePerson}
                      InputLabelProps={{ style: { color: "black" } }}
                    />
                  &lt;/Grid>
                  &lt;Grid item xs={12}>
                    &lt;TextField
                      variant="outlined"
                      label="Telefono/celular"
                      fullWidth
                      name="phone"
                      type="number"
                      onChange={handleChangePerson}
                      InputLabelProps={{ style: { color: "black" } }}
                    />
                  &lt;/Grid>
                  &lt;Grid item xs={12}>
                    &lt;TextField
                      variant="outlined"
                      label="Direccion"
                      fullWidth
                      name="description"
                      onChange={handleChangeAddress}
                      InputLabelProps={{ style: { color: "black" } }}
                    />
                  &lt;/Grid>
                  &lt;Grid item xs={12}>
                    &lt;Autocomplete
                      disablePortal
                      fullWidth
                      id="combo-box-demo"
                      options={kindUser}
                      onChange={(event, newValue) => {
                        setKindPerson({ ...kindPerson, type_user: newValue });
                      }}
                      renderInput={(params) => (
                        &lt;TextField
                          {...params}
                          label="Seleccione un tipo de usuario"
                        />
                      )}
                    />
                  &lt;/Grid>
                  &lt;Grid item xs={12}>
                    &lt;FormControl fullWidth variant="outlined">
                      &lt;InputLabel htmlFor="outlined-adornment-password">
                        Password
                      &lt;/InputLabel>
                      &lt;OutlinedInput
                        name="password"
                        onChange={handleChangePerson}
                        id="outlined-adornment-password"
                        type={showPassword ? "text" : "password"}
                        endAdornment={
                          &lt;InputAdornment position="end">
                            &lt;IconButton
                              aria-label="toggle password visibility"
                              onClick={handleClickShowPassword}
                              onMouseDown={handleMouseDownPassword}
                              edge="end"
                            >
                              {showPassword ? (
                                &lt;VisibilityOff />
                              ) : (
                                &lt;Visibility />
                              )}
                            &lt;/IconButton>
                          &lt;/InputAdornment>
                        }
                        label="Password"
                      />
                    &lt;/FormControl>
                  &lt;/Grid>
                  &lt;Grid item xs={12}>
                    &lt;Button
                      type="submit"
                      fullWidth
                      variant="contained"
                      color="primary"
                      disabled={
                        !person.first_name ||
                        !person.last_name ||
                        !person.email ||
                        !person.phone ||
                        !person.password ||
                        !kindPerson.type_user ||
                        !address.description
                      }
                      sx={{ mt: 2 }}
                    >
                      {loading ? (
                        &lt;CircularProgress color="inherit" size={30} />
                      ) : (
                        "Registrarse"
                      )}
                    &lt;/Button>
                    {showAlert &amp;&amp; (
                      &lt;div>
                        {error === "password" &amp;&amp; (
                          &lt;Alert severity="info" sx={{ mt: 2 }}>
                            La contraseña debe tener al menos 8 caracteres
                          &lt;/Alert>
                        )}
                        {error === "email-phone" &amp;&amp; (
                          &lt;Alert severity="warning" sx={{ mt: 2 }}>
                            El correo o el teléfono ya existen
                          &lt;/Alert>
                        )}
                        {error === "email" &amp;&amp; (
                          &lt;Alert severity="error" sx={{ mt: 2 }}>
                            La dirección de correo electronico no es valida, por
                            favor revise que su entrada se vea de la siguiente
                            manera: user@example.com
                          &lt;/Alert>
                        )}
                        {error === "phone" &amp;&amp; (
                          &lt;Alert severity="info" sx={{ mt: 2 }}>
                            El telefono debe tener 10 digitos
                          &lt;/Alert>
                        )}
                        {error === "address" &amp;&amp; (
                          &lt;Alert severity="info" sx={{ mt: 2 }}>
                            No se ha podido encontrar la direccion, sera
                            redirigido a una nueva pagina para validar la
                            direccion
                          &lt;/Alert>
                        )}
                      &lt;/div>
                    )}
                  &lt;/Grid>
                &lt;/Grid>
              &lt;/Box>
            &lt;/CardContent>
          &lt;/Card>
        &lt;/Box>
      &lt;/Container>
    &lt;/HelmetProvider>
  );
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Tue Mar 14 2023 17:59:30 GMT-0500 (hora estándar de Colombia)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
